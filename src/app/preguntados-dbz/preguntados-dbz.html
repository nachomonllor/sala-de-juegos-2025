<section class="wrapper" *ngIf="!loading(); else loadingTpl">
  <ng-container *ngIf="question() as q; else errorTpl">
    <header class="hud">
      <div><strong>Puntaje:</strong> {{ score() }} / {{ total() }}</div>
      <button type="button" class="btn ghost" (click)="resetScore()">Reiniciar</button>
    </header>

    <div class="card">
      <h2>¿Quién es este personaje?</h2>

      <div class="image-box">
        <img [src]="q.imageUrl" [alt]="q.correct.name" loading="eager">
      </div>

      <div class="options">
        <button
          *ngFor="let opt of q.options"
          type="button"
          class="btn option"
          [class.correct]="answered() && opt.id === q.correct.id"
          [class.wrong]="answered() && opt.id === selectedId() && opt.id !== q.correct.id"
          [disabled]="answered()"
          (click)="choose(opt.id)">
          {{ opt.name }}
        </button>
      </div>

      <div class="feedback" *ngIf="answered()">
        <p *ngIf="isCorrect(); else wrongTpl">✅ ¡Correcto! Era <strong>{{ q.correct.name }}</strong>.</p>
        <ng-template #wrongTpl>
          <p>❌ Incorrecto. La respuesta era <strong>{{ q.correct.name }}</strong>.</p>
        </ng-template>

        <button type="button" class="btn primary" (click)="nextQuestion()">Siguiente</button>
      </div>
    </div>
  </ng-container>
</section>

<ng-template #loadingTpl>
  <div class="loading">Cargando pregunta…</div>
</ng-template>

<ng-template #errorTpl>
  <div class="error">
    No fue posible cargar la pregunta. Intenta nuevamente.
    <button type="button" class="btn primary" (click)="nextQuestion()">Reintentar</button>
  </div>
</ng-template>

<div class="mt-3">
  <a routerLink="/home" class="btn btn-outline-primary">Volver al Home</a>
</div>
