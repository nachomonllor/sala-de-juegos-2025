<mat-card class="res-card solid">
  <mat-toolbar class="res-toolbar" color="primary">
    <span class="titulo grad-text">Resultados recientes</span>
    <span class="flex-espaciador"></span>

    <button mat-icon-button (click)="refrescar()" [disabled]="cargando()" matTooltip="Actualizar">
      <mat-icon>refresh</mat-icon>
    </button>
  </mat-toolbar>

  <div class="filtros">
    <mat-form-field appearance="outline" class="w-240">
      <mat-label>Juego</mat-label>
      <mat-select [value]="juegoSeleccionado()" (valueChange)="onJuegoChangeSelect($event)">
        <mat-option value="todos">Todos los juegos</mat-option>
        <mat-option *ngFor="let j of juegos" [value]="j">{{ j }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-checkbox [checked]="soloMios()" (change)="soloMios.set($event.checked)">
      Solo mis resultados
    </mat-checkbox>

    <mat-form-field appearance="outline" class="flex-1">
      <mat-label>Buscar (jugador, juego, puntos…)</mat-label>
      <input matInput (input)="onTextoFiltro($event)" placeholder="Filtrar en la tabla">
      <button *ngIf="textoFiltro()" matSuffix mat-icon-button aria-label="Limpiar" (click)="limpiarFiltro()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <mat-progress-bar *ngIf="cargando()" mode="indeterminate"></mat-progress-bar>

  <!-- Tabla -->

  <div class="tabla-wrap" *ngIf="!cargando()">
    <!-- table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z1" -->
    <table mat-table [dataSource]="dataSource" matSort class="dark-table">

      <!-- Fecha -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
        <td mat-cell *matCellDef="let r">{{ r.createdAt | date:'short' }}</td>
      </ng-container>

      <!-- Jugador -->
      <ng-container matColumnDef="userDisplayName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Jugador</th>
        <td mat-cell *matCellDef="let r">{{ r.userDisplayName }}</td>
      </ng-container>

      <!-- Juego -->
      <ng-container matColumnDef="gameCode">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Juego</th>
        <td mat-cell *matCellDef="let r">{{ r.gameCode }}</td>
      </ng-container>

      <!-- Puntos -->
      <ng-container matColumnDef="points">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="num">Puntos</th>
        <td mat-cell *matCellDef="let r" class="num">{{ r.points }}</td>
      </ng-container>

      <!-- Duración -->
      <ng-container matColumnDef="durationSec">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="num">Duración (s)</th>
        <td mat-cell *matCellDef="let r" class="num">{{ r.durationSec || '—' }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnas"></tr>
      <tr mat-row *matRowDef="let fila; columns: columnas;"></tr>
    </table>

    <mat-paginator [pageSize]="10" [pageSizeOptions]="[5,10,25,50]" showFirstLastButtons
      aria-label="Selector de páginas">
    </mat-paginator>
  </div>

  <!-- Vacío -->
  <div class="vacio" *ngIf="!cargando() && dataSource.data.length === 0 && !error()">
    <mat-icon>hourglass_empty</mat-icon>
    <p>Aún no hay resultados para este filtro.</p>
  </div>

  <!-- Error -->
  <div class="error" *ngIf="error()">
    <mat-icon color="warn">error</mat-icon>
    <span>{{ error() }}</span>
  </div>

</mat-card>



<!-- <mat-card class="res-card">

  <mat-toolbar class="res-toolbar" color="primary">
    <span class="titulo">Resultados recientes</span>
    <span class="flex-espaciador"></span>

    <button mat-icon-button (click)="refrescar()" [disabled]="cargando()"
            matTooltip="Actualizar">
      <mat-icon>refresh</mat-icon>
    </button>
  </mat-toolbar> -->







<!-- <section style="max-width:900px;margin:1rem auto;padding:1rem;">
  <header style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;">
    <h2 style="margin:0;">Resultados recientes</h2>

    <select (change)="onJuegoChange($event)">
      <option value="todos">Todos los juegos</option>
      <option *ngFor="let j of juegos" [value]="j">{{ j }}</option>
    </select>

    <label style="display:flex;gap:.35rem;align-items:center;">
      <input type="checkbox" [checked]="soloMios()" (change)="soloMios.set(($any($event.target).checked))">
      Solo mis resultados
    </label>

    <button (click)="refrescar()">Actualizar</button>
    <span *ngIf="cargando()">Cargando…</span>
    <span *ngIf="error()" style="color:#ff7070;">{{ error() }}</span>

  </header>

  <table *ngIf="!cargando()" style="width:100%;border-collapse:collapse;margin-top:1rem;">
    <thead>
      <tr>
        <th class="th">Fecha</th>
        <th class="th">Jugador</th>
        <th class="th">Juego</th>
        <th class="th num">Puntos</th>
        <th class="th num">Duración (s)</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of resultados()">
        <td class="td">{{ r.createdAt | date:'short' }}</td>
        <td class="td">{{ r.userDisplayName }}</td>
        <td class="td">{{ r.gameCode }}</td>
        <td class="td num">{{ r.points }}</td>
        <td class="td num">{{ r.durationSec || '—' }}</td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="!cargando() && !resultados().length && !error()" style="opacity:.7;margin-top:1rem;">
    Aún no hay resultados para este filtro.
  </p>
</section> -->