<mat-toolbar color="primary" class="toolbar">
  <span>üó®Ô∏è Sala de Chat</span>
  <span class="spacer"></span>
  <button mat-icon-button aria-label="Recargar" (click)="ngOnInit()">
    <mat-icon>refresh</mat-icon>
  </button>
</mat-toolbar>

<mat-card class="chat-card">
  <!-- Lista de mensajes (una sola) -->
  <div class="messages" #scrollContainer>
    <div class="msg" *ngFor="let m of messages; trackBy: trackById" [class.mine]="isMine(m)" [class.other]="!isMine(m)"
      [class.sending]="m.status === 'sending'" [class.failed]="m.status === 'failed'">
      <!-- Avatar / inicial -->
      <div class="avatar" aria-hidden="true">
        {{ (m?.display_name || 'A') | slice:0:1 | uppercase }}
      </div>

      <!-- Burbuja -->
      <div class="bubble">
        <div class="meta">
          <b class="name">{{ m?.display_name || 'An√≥nimo' }}</b>
          <small class="time">{{ m?.created_at | date:'short' }}</small>

          <!-- Estado -->
          <span class="state" *ngIf="m.status === 'sending'">
            <mat-progress-spinner diameter="14" mode="indeterminate"></mat-progress-spinner>
            <small>Enviando‚Ä¶</small>
          </span>
          <span class="state error" *ngIf="m.status === 'failed'">
            <mat-icon fontIcon="error" aria-hidden="true"></mat-icon>
            <small>Error</small>
            <button mat-button color="warn" class="retry" (click)="retry(m)">Reintentar</button>
          </span>
        </div>

        <div class="text">
          {{ m?.message }}
        </div>

        <span class="state error" *ngIf="m.status === 'failed'" [title]="m.errorMsg || ''">
          <mat-icon fontIcon="error"></mat-icon>
          <small>Error</small>
          <button mat-button color="warn" class="retry" (click)="retry(m)">Reintentar</button>
        </span>

      </div>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- Indicador "est√° escribiendo‚Ä¶" -->
  <div class="typing" *ngIf="typingIndicator as tip">
    <mat-icon fontIcon="more_horiz" aria-hidden="true"></mat-icon>
    <span>{{ tip }}</span>
  </div>

  <!-- Composer -->
  <form class="composer" (ngSubmit)="send()">
    <mat-form-field appearance="fill" class="input-field">
      <textarea matInput [(ngModel)]="text" name="text" placeholder="Escribe un mensaje‚Ä¶"
        (keydown)="handleEnter($event)" cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1"
        cdkAutosizeMaxRows="6"></textarea>
    </mat-form-field>

    <button mat-fab color="primary" type="submit" [disabled]="sending || !text.trim()" aria-label="Enviar">
      <mat-icon>send</mat-icon>
    </button>
  </form>
</mat-card>






<!-- <mat-toolbar color="primary" class="toolbar">
  <span>üó®Ô∏è Sala de Chat</span>
  <span class="spacer"></span>
  <button mat-icon-button aria-label="Recargar" (click)="ngOnInit()">
    <mat-icon>refresh</mat-icon>
  </button>
</mat-toolbar>

<mat-card class="chat-card">
  <div class="messages" #scrollContainer>
    <div class="msg" *ngFor="let m of messages; trackBy: trackById" [class.mine]="isMine(m)" [class.other]="!isMine(m)">

      
      <div class="avatar" aria-hidden="true">
        {{ (m?.display_name || 'A') | slice:0:1 | uppercase }}
      </div>

      Burbuja 
      <div class="bubble">
        <div class="meta">
          <b class="name">{{ m?.display_name || 'An√≥nimo' }}</b>
          <small class="time">{{ m?.created_at | date:'short' }}</small>
        </div>
        <div class="text">
          {{ m?.message }}
        </div>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>


  <div class="messages" #scrollContainer>
    <div class="msg" *ngFor="let m of messages; trackBy: trackById" [class.mine]="isMine(m)" [class.other]="!isMine(m)"
      [class.sending]="m.status === 'sending'" [class.failed]="m.status === 'failed'">
      <div class="avatar" aria-hidden="true">
        {{ (m?.display_name || 'A') | slice:0:1 | uppercase }}
      </div>

      <div class="bubble">
        <div class="meta">
          <b class="name">{{ m?.display_name || 'An√≥nimo' }}</b>
          <small class="time">{{ m?.created_at | date:'short' }}</small>

          <span class="state" *ngIf="m.status === 'sending'">
            <mat-progress-spinner diameter="14" mode="indeterminate"></mat-progress-spinner>
            <small>Enviando‚Ä¶</small>
          </span>
          <span class="state error" *ngIf="m.status === 'failed'">
            <mat-icon fontIcon="error" aria-hidden="true"></mat-icon>
            <small>Error</small>
            <button mat-button color="warn" class="retry" (click)="retry(m)">Reintentar</button>
          </span>
        </div>

        <div class="text">
          {{ m?.message }}
        </div>
      </div>
    </div>
  </div>

  <div class="typing" *ngIf="typingIndicator as tip">
    <mat-icon fontIcon="more_horiz" aria-hidden="true"></mat-icon>
    <span>{{ tip }}</span>
  </div>

  <form class="composer" (ngSubmit)="send()">
    <mat-form-field appearance="fill" class="input-field">
      <textarea matInput [(ngModel)]="text" name="text" placeholder="Escribe un mensaje‚Ä¶"
        (keydown)="handleEnter($event)" cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1"
        cdkAutosizeMaxRows="6"></textarea>
    </mat-form-field>

    <button mat-fab color="primary" type="submit" [disabled]="!text.trim()" aria-label="Enviar">
      <mat-icon>send</mat-icon>
    </button>
  </form>
</mat-card>


 -->